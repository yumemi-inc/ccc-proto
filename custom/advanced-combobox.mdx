---
title: AdvancedCombobox
description: æ¤œç´¢å±¥æ­´ã¨ãŠæ°—ã«å…¥ã‚Šæ©Ÿèƒ½ã‚’å‚™ãˆãŸé«˜æ©Ÿèƒ½ãªComboboxã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
sidebar_position: 2
tags:
  - ãƒ•ã‚©ãƒ¼ãƒ 
  - æ¤œç´¢
---

import { useState, useEffect } from "react";
import {
  Combobox,
  Input,
  InputBase,
  useCombobox,
  Text,
  Group,
  ActionIcon,
  Badge,
  Stack,
  Box,
  Button,
} from "@mantine/core";
import {
  IconSearch,
  IconStar,
  IconStarFilled,
  IconClock,
  IconX,
} from "@tabler/icons-react";

# AdvancedCombobox

æ¤œç´¢å±¥æ­´ã¨ãŠæ°—ã«å…¥ã‚Šæ©Ÿèƒ½ã‚’å‚™ãˆãŸé«˜æ©Ÿèƒ½ãª Combobox ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚

## æ¦‚è¦

`AdvancedCombobox`ã¯ã€Mantine UI ã®`Combobox`ã‚’æ‹¡å¼µã—ã¦ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’è¿½åŠ ã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ï¼š

- **æ¤œç´¢å±¥æ­´æ©Ÿèƒ½**: éå»ã®æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä¿å­˜ãƒ»è¡¨ç¤º
- **ãŠæ°—ã«å…¥ã‚Šæ©Ÿèƒ½**: ã‚ˆãä½¿ã†é …ç›®ã‚’ãŠæ°—ã«å…¥ã‚Šã«ç™»éŒ²
- **ã‚«ãƒ†ã‚´ãƒªè¡¨ç¤º**: å±¥æ­´ãƒ»ãŠæ°—ã«å…¥ã‚Šãƒ»æ¤œç´¢çµæœã‚’åˆ†é¡è¡¨ç¤º
- **ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ**: çŸ¢å°ã‚­ãƒ¼ã§ã®é¸æŠã€Enter ã§æ±ºå®š

## ãƒ©ã‚¤ãƒ–ãƒ‡ãƒ¢

export const AdvancedComboboxDemo = () => {
  const [value, setValue] = useState('');
  const [searchHistory, setSearchHistory] = useState([
    'React', 'TypeScript', 'JavaScript', 'Next.js'
  ]);
  const [favorites, setFavorites] = useState(['React', 'TypeScript']);
  
  const combobox = useCombobox({
    onDropdownClose: () => combobox.resetSelectedOption(),
  });

const allOptions = [
'React', 'TypeScript', 'JavaScript', 'Next.js', 'Vue.js',
'Angular', 'Svelte', 'Node.js', 'Python', 'Java', 'C++', 'Go'
];

const filteredOptions = allOptions.filter((item) =>
item.toLowerCase().includes(value.toLowerCase().trim())
);

const toggleFavorite = (item) => {
setFavorites(prev =>
prev.includes(item)
? prev.filter(fav => fav !== item)
: [...prev, item]
);
};

const selectItem = (item) => {
setValue(item);
combobox.closeDropdown();

    // å±¥æ­´ã«è¿½åŠ ï¼ˆé‡è¤‡å‰Šé™¤ï¼‰
    setSearchHistory(prev => {
      const filtered = prev.filter(h => h !== item);
      return [item, ...filtered].slice(0, 5); // æœ€å¤§5ä»¶
    });

};

const clearHistory = () => {
setSearchHistory([]);
};

const renderSection = (title, items, icon, showClear = false) => {
if (items.length === 0) return null;

    return (
      <>
        <Combobox.Group>
          <Group justify="space-between" px="xs" py={4}>
            <Group gap={4}>
              {icon}
              <Text size="xs" fw={500} c="dimmed">{title}</Text>
            </Group>
            {showClear && (
              <ActionIcon
                variant="subtle"
                size="xs"
                onClick={clearHistory}
                aria-label="å±¥æ­´ã‚’ã‚¯ãƒªã‚¢"
              >
                <IconX size={12} />
              </ActionIcon>
            )}
          </Group>
        </Combobox.Group>
        {items.map((item) => (
          <Combobox.Option value={item} key={item}>
            <Group justify="space-between">
              <Text size="sm">{item}</Text>
              <ActionIcon
                variant="subtle"
                size="sm"
                onClick={(e) => {
                  e.stopPropagation();
                  toggleFavorite(item);
                }}
                aria-label={`${item}ã‚’ãŠæ°—ã«å…¥ã‚Š${favorites.includes(item) ? 'è§£é™¤' : 'è¿½åŠ '}`}
              >
                {favorites.includes(item) ?
                  <IconStarFilled size={14} color="gold" /> :
                  <IconStar size={14} />
                }
              </ActionIcon>
            </Group>
          </Combobox.Option>
        ))}
      </>
    );

};

return (

<Box>
<Combobox
        store={combobox}
        withinPortal={false}
        onOptionSubmit={selectItem}
      >
<Combobox.Target>
<InputBase
component="button"
type="button"
pointer
rightSection={<Combobox.Chevron />}
rightSectionPointerEvents="none"
onClick={() => combobox.openDropdown()}
onFocus={() => combobox.openDropdown()}
onBlur={() => combobox.closeDropdown()}
placeholder="æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã‚’é¸æŠ..."
leftSection={<IconSearch size={16} />} >
{value || <Input.Placeholder>æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã‚’é¸æŠ...</Input.Placeholder>}
</InputBase>
</Combobox.Target>

        <Combobox.Dropdown>
          <Combobox.Search
            value={value}
            onChange={(event) => setValue(event.currentTarget.value)}
            placeholder="æ¤œç´¢..."
          />

          <Combobox.Options>
            {value.trim() === '' && (
              <>
                {renderSection(
                  'ãŠæ°—ã«å…¥ã‚Š',
                  favorites,
                  <IconStarFilled size={12} color="gold" />
                )}
                {renderSection(
                  'æœ€è¿‘ã®æ¤œç´¢',
                  searchHistory.filter(h => !favorites.includes(h)),
                  <IconClock size={12} />,
                  true
                )}
              </>
            )}

            {renderSection(
              value.trim() === '' ? 'ã™ã¹ã¦ã®é¸æŠè‚¢' : 'æ¤œç´¢çµæœ',
              filteredOptions.filter(item =>
                value.trim() === '' || !favorites.includes(item) && !searchHistory.includes(item)
              ),
              <IconSearch size={12} />
            )}

            {value.trim() !== '' && filteredOptions.length === 0 && (
              <Combobox.Empty>è©²å½“ã™ã‚‹é …ç›®ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</Combobox.Empty>
            )}
          </Combobox.Options>
        </Combobox.Dropdown>
      </Combobox>

      {value && (
        <Box mt="md">
          <Text size="sm" c="dimmed">é¸æŠã•ã‚ŒãŸæŠ€è¡“:</Text>
          <Badge size="lg" mt={4}>{value}</Badge>
        </Box>
      )}
    </Box>

);
};

<AdvancedComboboxDemo />

## å®Ÿè£…ã‚³ãƒ¼ãƒ‰

```tsx
import { useState } from "react";
import {
  Combobox,
  Input,
  InputBase,
  useCombobox,
  Text,
  Group,
  ActionIcon,
} from "@mantine/core";
import {
  IconSearch,
  IconStar,
  IconStarFilled,
  IconClock,
  IconX,
} from "@tabler/icons-react";

interface AdvancedComboboxProps {
  data: string[];
  placeholder?: string;
  maxHistory?: number;
  value?: string;
  onChange?: (value: string) => void;
}

export function AdvancedCombobox({
  data,
  placeholder = "é¸æŠã—ã¦ãã ã•ã„...",
  maxHistory = 5,
  value: controlledValue,
  onChange,
}: AdvancedComboboxProps) {
  const [value, setValue] = useState(controlledValue || "");
  const [searchHistory, setSearchHistory] = useState<string[]>([]);
  const [favorites, setFavorites] = useState<string[]>([]);

  const combobox = useCombobox({
    onDropdownClose: () => combobox.resetSelectedOption(),
  });

  const filteredOptions = data.filter((item) =>
    item.toLowerCase().includes(value.toLowerCase().trim())
  );

  const toggleFavorite = (item: string) => {
    setFavorites((prev) =>
      prev.includes(item) ? prev.filter((fav) => fav !== item) : [...prev, item]
    );
  };

  const selectItem = (item: string) => {
    setValue(item);
    onChange?.(item);
    combobox.closeDropdown();

    // å±¥æ­´ã«è¿½åŠ 
    setSearchHistory((prev) => {
      const filtered = prev.filter((h) => h !== item);
      return [item, ...filtered].slice(0, maxHistory);
    });
  };

  const clearHistory = () => {
    setSearchHistory([]);
  };

  const renderSection = (
    title: string,
    items: string[],
    icon: React.ReactNode,
    showClear = false
  ) => {
    if (items.length === 0) return null;

    return (
      <>
        <Combobox.Group>
          <Group justify="space-between" px="xs" py={4}>
            <Group gap={4}>
              {icon}
              <Text size="xs" fw={500} c="dimmed">
                {title}
              </Text>
            </Group>
            {showClear && (
              <ActionIcon variant="subtle" size="xs" onClick={clearHistory}>
                <IconX size={12} />
              </ActionIcon>
            )}
          </Group>
        </Combobox.Group>
        {items.map((item) => (
          <Combobox.Option value={item} key={item}>
            <Group justify="space-between">
              <Text size="sm">{item}</Text>
              <ActionIcon
                variant="subtle"
                size="sm"
                onClick={(e) => {
                  e.stopPropagation();
                  toggleFavorite(item);
                }}
              >
                {favorites.includes(item) ? (
                  <IconStarFilled size={14} color="gold" />
                ) : (
                  <IconStar size={14} />
                )}
              </ActionIcon>
            </Group>
          </Combobox.Option>
        ))}
      </>
    );
  };

  return (
    <Combobox store={combobox} onOptionSubmit={selectItem}>
      <Combobox.Target>
        <InputBase
          component="button"
          type="button"
          pointer
          rightSection={<Combobox.Chevron />}
          rightSectionPointerEvents="none"
          onClick={() => combobox.openDropdown()}
          onFocus={() => combobox.openDropdown()}
          onBlur={() => combobox.closeDropdown()}
          placeholder={placeholder}
          leftSection={<IconSearch size={16} />}
        >
          {value || <Input.Placeholder>{placeholder}</Input.Placeholder>}
        </InputBase>
      </Combobox.Target>

      <Combobox.Dropdown>
        <Combobox.Search
          value={value}
          onChange={(event) => setValue(event.currentTarget.value)}
          placeholder="æ¤œç´¢..."
        />

        <Combobox.Options>
          {value.trim() === "" && (
            <>
              {renderSection(
                "ãŠæ°—ã«å…¥ã‚Š",
                favorites,
                <IconStarFilled size={12} color="gold" />
              )}
              {renderSection(
                "æœ€è¿‘ã®æ¤œç´¢",
                searchHistory.filter((h) => !favorites.includes(h)),
                <IconClock size={12} />,
                true
              )}
            </>
          )}

          {renderSection(
            value.trim() === "" ? "ã™ã¹ã¦ã®é¸æŠè‚¢" : "æ¤œç´¢çµæœ",
            filteredOptions.filter(
              (item) =>
                value.trim() === "" ||
                (!favorites.includes(item) && !searchHistory.includes(item))
            ),
            <IconSearch size={12} />
          )}

          {value.trim() !== "" && filteredOptions.length === 0 && (
            <Combobox.Empty>è©²å½“ã™ã‚‹é …ç›®ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</Combobox.Empty>
          )}
        </Combobox.Options>
      </Combobox.Dropdown>
    </Combobox>
  );
}
```

## ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

| ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£    | å‹                        | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ              | èª¬æ˜                                 |
| ------------- | ------------------------- | ----------------------- | ------------------------------------ |
| `data`        | `string[]`                | -                       | é¸æŠè‚¢ã®ãƒ‡ãƒ¼ã‚¿é…åˆ—                   |
| `placeholder` | `string`                  | `"é¸æŠã—ã¦ãã ã•ã„..."` | ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆ             |
| `maxHistory`  | `number`                  | `5`                     | ä¿å­˜ã™ã‚‹å±¥æ­´ã®æœ€å¤§ä»¶æ•°               |
| `value`       | `string`                  | -                       | åˆ¶å¾¡ã•ã‚ŒãŸå€¤ï¼ˆåˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç”¨ï¼‰ |
| `onChange`    | `(value: string) => void` | -                       | å€¤å¤‰æ›´æ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯               |

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬çš„ãªä½¿ç”¨

```tsx
const techStack = [
  "React",
  "TypeScript",
  "JavaScript",
  "Next.js",
  "Vue.js",
  "Angular",
  "Svelte",
  "Node.js",
];

<AdvancedCombobox data={techStack} placeholder="æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã‚’é¸æŠ..." />;
```

### åˆ¶å¾¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦ä½¿ç”¨

```tsx
const [selectedTech, setSelectedTech] = useState("");

<AdvancedCombobox
  data={techStack}
  value={selectedTech}
  onChange={setSelectedTech}
  maxHistory={3}
/>;
```

## ç‰¹å¾´

- **ğŸ” ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«æ¤œç´¢**: å…¥åŠ›ã«å¿œã˜ã¦ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- **â­ ãŠæ°—ã«å…¥ã‚Šæ©Ÿèƒ½**: ã‚ˆãä½¿ã†é …ç›®ã‚’æ˜Ÿå°ã§ç®¡ç†
- **ğŸ•’ æ¤œç´¢å±¥æ­´**: éå»ã®é¸æŠã‚’è‡ªå‹•ä¿å­˜ï¼ˆæœ€å¤§ä»¶æ•°è¨­å®šå¯èƒ½ï¼‰
- **ğŸ¯ ç›´æ„Ÿçš„ãª UI**: ã‚¢ã‚¤ã‚³ãƒ³ã¨ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã§è¦–èªæ€§å‘ä¸Š
- **âŒ¨ï¸ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å¯¾å¿œ**: çŸ¢å°ã‚­ãƒ¼ãƒ»Enter ã‚­ãƒ¼ã§ã®æ“ä½œ
- **â™¿ ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£**: ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œ

## ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºä¾‹

### å¤§ããªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§ã®ä½¿ç”¨

å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†å ´åˆã¯ã€ä»®æƒ³åŒ–ã‚„ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ï¼š

```tsx
// 10,000ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã§ã‚‚é«˜é€Ÿå‹•ä½œ
const largeDataset = Array.from({ length: 10000 }, (_, i) => `é …ç›® ${i + 1}`);

<AdvancedCombobox data={largeDataset} maxHistory={10} />;
```

### ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°

Mantine ã®ãƒ†ãƒ¼ãƒã‚·ã‚¹ãƒ†ãƒ ã‚’æ´»ç”¨ã—ã¦ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ï¼š

```tsx
<AdvancedCombobox data={data} style={{ maxWidth: 400 }} />
```

ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã‚’é‡è¦–ã—ãŸè¨­è¨ˆã§ã€å®Ÿéš›ã®ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚‚ä½¿ç”¨ã§ãã‚‹å“è³ªã‚’ç›®æŒ‡ã—ã¦ã„ã¾ã™ã€‚
